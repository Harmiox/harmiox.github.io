/*
* bubbletip
*
* Copyright (c) 2009-2010, UhLeeKa.
* Version: 
*      1.0.6
* Licensed under the GNU Lesser General Public License:
*     http://www.gnu.org/licenses/lgpl-3.0.html
* Author Website: 
*     http://www.uhleeka.com
* Project Hosting on Google Code: 
*     http://code.google.com/p/bubbletip/
*/
(function(t){var n=0;t.fn.extend({bubbletip:function(r,i){function g(){var n;if(c){return}c=true;if(h){p.stop(true,false)}if(u.calculateOnShow){b()}if(u.positionAt.match(/^element|body$/i)){if(u.deltaDirection.match(/^up|down$/i)){if(!h){p.css("top",parseInt(a.top+a.delta)+"px")}n={top:a.top+"px"}}else{if(!h){p.css("left",parseInt(a.left+a.delta)+"px")}n={left:a.left+"px"}}}else{if(u.deltaDirection.match(/^up|down$/i)){if(!h){a.mouseTop=e.pageY+a.top;p.css({top:parseInt(a.mouseTop+a.delta)+"px",left:parseInt(e.pageX-p.width()/2)+"px"})}n={top:a.mouseTop+"px"}}else{if(!h){a.mouseLeft=e.pageX+a.left;p.css({left:parseInt(a.mouseLeft+a.delta)+"px",top:parseInt(e.pageY-p.height()/2)+"px"})}n={left:a.left+"px"}}}h=false;s.css("position","relative");p.show();n=t.extend(n,{opacity:1});p.animate(n,u.animationDuration,u.animationEasing,function(){p.css("opacity","");c=true})}function y(){var e;c=false;h=true;if(u.positionAt.match(/^element|body$/i)){if(u.deltaDirection.match(/^up|down$/i)){e={top:parseInt(a.top-a.delta)+"px"}}else{e={left:parseInt(a.left-a.delta)+"px"}}}else{if(u.deltaDirection.match(/^up|down$/i)){e={top:parseInt(a.mouseTop-a.delta)+"px"}}else{e={left:parseInt(a.mouseLeft-a.delta)+"px"}}}e=t.extend(e,{opacity:0});p.animate(e,u.animationDuration,u.animationEasing,function(){p.hide();h=false})}function b(){if(u.positionAt.match(/^element$/i)){var e=u.positionAtElement.offset();if(u.deltaDirection.match(/^up$/i)){a.top=e.top+u.offsetTop-p.outerHeight()+u.deltaShift;a.left=e.left+u.offsetLeft+(u.positionAtElement.outerWidth()-p.outerWidth())/2;a.delta=u.deltaPosition}else if(u.deltaDirection.match(/^down$/i)){a.top=e.top+u.positionAtElement.outerHeight()+u.offsetTop-u.deltaShift;a.left=e.left+u.offsetLeft+(u.positionAtElement.outerWidth()-p.outerWidth())/2;a.delta=-u.deltaPosition}else if(u.deltaDirection.match(/^left$/i)){a.top=e.top+u.offsetTop+(u.positionAtElement.outerHeight()-p.outerHeight())/2;a.left=e.left+u.offsetLeft-p.outerWidth()+u.deltaShift;a.delta=u.deltaPosition}else if(u.deltaDirection.match(/^right$/i)){a.top=e.top+u.offsetTop+(u.positionAtElement.outerHeight()-p.outerHeight())/2;a.left=e.left+u.positionAtElement.outerWidth()+u.offsetLeft-u.deltaShift;a.delta=-u.deltaPosition}}else if(u.positionAt.match(/^body$/i)){if(u.deltaDirection.match(/^up|left$/i)){a.top=u.offsetTop;a.left=u.offsetLeft;a.delta=u.deltaPosition}else{if(u.deltaDirection.match(/^down$/i)){a.top=parseInt(u.offsetTop+p.outerHeight());a.left=u.offsetLeft}else{a.top=u.offsetTop;a.left=parseInt(u.offsetLeft+p.outerWidth())}a.delta=-u.deltaPosition}}else if(u.positionAt.match(/^mouse$/i)){if(u.deltaDirection.match(/^up|left$/i)){if(u.deltaDirection.match(/^up$/i)){a.top=-(u.offsetTop+p.outerHeight());a.left=u.offsetLeft}else if(u.deltaDirection.match(/^left$/i)){a.top=u.offsetTop;a.left=-(u.offsetLeft+p.outerWidth())}a.delta=u.deltaPosition}else{a.top=u.offsetTop;a.left=u.offsetLeft;a.delta=-u.deltaPosition}}if(u.positionAt.match(/^element|body$/i)){p.css({position:"absolute",top:a.top+"px",left:a.left+"px"})}}if(t("div.bubbletip #"+t(r).get(0).id).length>0){return this}var s,o,u,a,f,l,c,h,p,d;var v,m;s=t(this);o=t(r);d=n++;u={wrapperContainer:"body",positionAt:"element",positionAtElement:s,offsetTop:0,offsetLeft:0,deltaPosition:30,deltaShift:10,deltaDirection:"up",animationDuration:250,animationEasing:"swing",bindShow:"mouseover",bindHide:"mouseout",bindClose:"click",delayShow:0,delayHide:500,calculateOnShow:false,showOnInit:false};if(i){u=t.extend(u,i)}a={top:0,left:0,delta:0,mouseTop:0,mouseLeft:0,bindShow:(u.bindShow+" ").replace(/ +/g,".bubbletip"+d+" "),bindHide:(u.bindHide+" ").replace(/ +/g,".bubbletip"+d+" "),bindClose:(u.bindClose+" ").replace(/ +/g,".bubbletip"+d+" ")};f=null;l=null;c=false;h=false;if(!s.data("bubbletip_tips")){s.data("bubbletip_tips",[[o.get(0).id,d]])}else{s.data("bubbletip_tips",t.merge(s.data("bubbletip_tips"),[[o.get(0).id,d]]))}if(!u.positionAt.match(/^element|body|mouse$/i)){u.positionAt="element"}if(!u.deltaDirection.match(/^up|down|left|right$/i)){u.deltaDirection="up"}if(u.deltaDirection.match(/^up$/i)){p=t('<div class="bubbletip bt-up"><div class="bt-content"></div></div>')}else if(u.deltaDirection.match(/^down$/i)){p=t('<div class="bubbletip bt-down"><div class="bt-content"></div></div>')}else if(u.deltaDirection.match(/^left$/i)){p=t('<div class="bubbletip bt-left"><div class="bt-content"></div></div>')}else if(u.deltaDirection.match(/^right$/i)){p=t('<div class="bubbletip bt-right"><div class="bt-content"></div></div>')}p.appendTo(u.wrapperContainer);if(/msie/.test(navigator.userAgent.toLowerCase())&&!/opera/.test(navigator.userAgent.toLowerCase())){t("*",p).each(function(){var e=t(this).css("background-image");if(e.match(/^url\(["']?(.*\.png)["']?\)$/i)){e=RegExp.$1;t(this).css({backgroundImage:"none",filter:"progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled=true, sizingMethod="+(t(this).css("backgroundRepeat")=="no-repeat"?"crop":"scale")+", src='"+e+"')"}).each(function(){var e=t(this).css("position");if(e!="absolute"&&e!="relative")t(this).css("position","relative")})}})}t(".bt-content",p).append(o);o.show();p.css("opacity",0);p.css({width:p.width()+2,height:p.height()});b();p.hide();t(window).bind("resize.bubbletip"+d,function(){var e=t(window).width();var n=t(window).height();if(e===v&&n===m){return}v=e;m=n;if(l){clearTimeout(l)}l=setTimeout(function(){b()},250)});t([p.get(0),this.get(0)]).bind(a.bindShow,function(){if(f){clearTimeout(f)}if(u.delayShow===0){g()}else{f=setTimeout(function(){g()},u.delayShow)}return false}).bind(a.bindHide,function(){if(f){clearTimeout(f)}if(u.delayHide===0){y()}else{f=setTimeout(function(){y()},u.delayHide)}return false});t(p.get(0)).bind(a.bindClose,function(){h=true;p.animate({opacity:0},u.animationDuration,u.animationEasing,function(){p.hide();h=false;c=false})});if(u.showOnInit){g()}return this},removeBubbletip:function(e){var n;var r=new Array;var i=new Array;var s,o,u;var a;n=t.makeArray(t(this).data("bubbletip_tips"));s=t.makeArray(e);for(o=0;o<s.length;o++){r.push(t(s[o]).get(0).id)}for(o=0;o<n.length;o++){u=null;if(r.length==0||(u=t.inArray(n[o][0],r))>=0){a=t("#"+n[o][0]).get(0).parentNode;while(a.tagName.toLowerCase()!="table"){a=a.parentNode}t("#"+n[o][0]).appendTo(_options.wrapperContainer).hide();t(a).remove();t(this).unbind(".bubbletip"+n[o][1]);t(window).unbind(".bubbletip"+n[o][1])}else{i.push(n[o])}}t(this).data("bubbletip_tips",i);return this}})})(jQuery)